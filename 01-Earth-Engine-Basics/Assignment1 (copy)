// Assignment
// Export the Night Lights images for May,2015 and May,2020

// Workflow:
// Load the VIIRS Nighttime Day/Night Band Composites collection
// Filter the collection to the date range
// Extract the 'avg_rad' band which represents the nighttime lights
// Clip the image to the geometry of your city
// Export the resulting image as a GeoTIFF file.

// Hint1: 

// There are 2 VIIRS Nighttime Day/Night collections
// Use the one that corrects for stray light

// Hint2: 

// The collection contains 1 global image per month
// After filtering for the month, there will be only 1 image in the collection

// You can use the following technique to extract that image
// var image = ee.Image(filtered.first())

var dataset = ee.ImageCollection("NOAA/VIIRS/DNB/MONTHLY_V1/VCMSLCFG");
var urban = ee.FeatureCollection("users/ujavalgandhi/e2e/ne_10m_urban_areas")

var filtered = urban.filter(ee.Filter.eq('system:index', '00000000000000001205'))
var geometry = filtered.geometry()
Map.centerObject(geometry, 10)

var nighttimeVis = {
  min: 0.0,
  max: 60,
  bands: 'avg_rad'
};


// May 2015
var filtered = dataset.filter(ee.Filter.date('2015-05-01', '2015-05-31'));
var image = ee.Image(filtered.first());
var clipped = image.clip(geometry);
Map.addLayer(clipped, nighttimeVis, 'Clipped 2015')

var exportImage = clipped.select('avg_rad')

Export.image.toDrive({
    image: exportImage,
    description: 'Albany_Night_Lights_May_2015',
    folder: 'earthengine',
    fileNamePrefix: 'albany_night_lights_May_2015',
    region: geometry,
    scale: 20,
    maxPixels: 1e9
})


// May 2020
var filtered = dataset.filter(ee.Filter.date('2020-05-01', '2020-05-31'));
var image = ee.Image(filtered.first());
var clipped = image.clip(geometry);
Map.addLayer(clipped, nighttimeVis, 'Clipped 2020')

var exportImage = clipped.select('avg_rad')

Export.image.toDrive({
    image: exportImage,
    description: 'Albany_Night_Lights_May_2020',
    folder: 'earthengine',
    fileNamePrefix: 'albany_night_lights_may_2020',
    region: geometry,
    scale: 20,
    maxPixels: 1e9
})

