/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var bangalore = ee.FeatureCollection("users/ujavalgandhi/public/bangalore_boundary"),
    chirps = ee.ImageCollection("UCSB-CHG/CHIRPS/PENTAD");
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// Calculate Long Term Rainfall Average 

// CHIRPS data comes as Pentad
// We can compute monthly long term averages

// Long Period Average (LPA) should by 30 years or more

// List of 30 years
var lpaYears = ee.List.sequence(1987, 2016)
var months = ee.List.sequence(1, 12)
print(lpaYears)

var monthlyImages = lpaYears.map(function(year) {
  return months.map(function(month) {
    var filtered = chirps.filter(ee.Filter.calendarRange(year, year, 'year'))
      .filter(ee.Filter.calendarRange(month, month, 'month'))
    var monthlyTotal = filtered.sum()
    return monthlyTotal.set({'month': month, 'year': year})
  })
}).flatten()
print(monthlyImages)
var monthlyCol = ee.ImageCollection.fromImages(monthlyImages)

var monthlyRainfall = months.map(function(month) {
  var filtered = monthlyCol.filter(ee.Filter.eq('month', month))
  var monthlyMean = filtered.mean()
  return monthlyMean.set('month', month)
})
print(monthlyRainfall)
